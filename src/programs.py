from typing import Callable, Dict, List

from controls import DEFAULT_ARM_SPEED, move_to_pose, home_gripper, move_to_home, grasp
from notifier import notify_arm_location, notify_handover_finished


class MoveToHandoverProgram:
    def __init__(self, target_1: tuple, target_2: tuple, speed: float):
      self.target_1 = target_1
      self.target_2 = target_2
      self.speed = speed


class ContainerProgram:
    def __init__(self, container_pose: tuple, rotation_pose: tuple):
      self.container_pose = container_pose
      self.rotation_pose = rotation_pose


left_tray_index = 0
right_tray_index = 0

packaging_containers: List[ContainerProgram] = [
    ContainerProgram(
        [-0.010023348557065725, -1.7079192760032518, 1.6999780956344666, -1.6403701248503568, 0.15241088191079502, 2.8367659405469907, -0.7548797059522734, 0.015098736621439457, 0.015098736621439457],
        [-0.0033192516823805735, -1.6961195568810383, 1.6810605170405049, -1.6311758842802881, 0.280698299659623, 2.8368289743424793, -0.25135923787620335, 0.015098736621439457, 0.015098736621439457]
    ),
    ContainerProgram(
        [-0.03201815732686143, -1.7040221984559962, 1.6941629300579082, -1.7901759392541843, 0.2830293888383441, 2.837107262704107, -0.9460787956383493, 0.015098736621439457, 0.015098736621439457],
        [-0.03217737962673798, -1.6995354017793085, 1.7005778149889224, -1.79213025795786, 0.2845354160277524, 2.8370995443179186, -0.20318402414189446, 0.015098736621439457, 0.015098736621439457]
    ),
    ContainerProgram(
        [-0.1604143112918787, -1.700683772905683, 1.6941169197015098, -1.8542605280771645, 0.2842621836966266, 2.8376643706295224, -0.9449058851069874, 0.015098736621439457, 0.015098736621439457],
        [-0.1625585885966478, -1.699506622732732, 1.6915988883693316, -1.854547183388158, 0.28533237124813926, 2.8376658965084287, -0.18449669544564354, 0.015098736621439457, 0.015098736621439457]
    ),
    ContainerProgram(
        [-0.35687022110035543, -1.7323485348429901, 1.6545607295771136, -1.8012316790798255, 0.2839151480330361, 2.837644981577617, -0.9331039174861377, 0.015098736621439457, 0.015098736621439457],
        [-0.3656508367438065, -1.7319905478294069, 1.6516638260891563, -1.800578189565424, 0.28823308206512743, 2.837632927502794, -0.08346200291977988, 0.015098736621439457, 0.015098736621439457]
    ),
    ContainerProgram(
        [-0.6469529692290898, -1.7514654362735431, 1.6342895437876384, -1.6461642797369707, 0.28347464222483915, 2.8385737054480447, -0.8861830274727608, 0.015098736621439457, 0.015098736621439457],
        [-0.6469568364160103, -1.7513874364652149, 1.6391983439127604, -1.6433231790442213, 0.2945183922254899, 2.8385839542680316, -0.05900522629088825, 0.015098736621439457, 0.015098736621439457]
    ),
]
current_container_index = 0
number_of_items_in_container = 0


left_tray_handovers: List[MoveToHandoverProgram] = [
    MoveToHandoverProgram(
        [-1.7345892382839267, -1.6977629277915283, 1.8864148556132514, -2.4758733792003373, 0.13989522051277847, 2.7058916587192914, -0.5809533127612536, 0.015092169865965843, 0.015092169865965843],
        [-1.9635976442872431, -1.726051660183413, 1.800327525925218, -2.0999296435010204, 0.08599873777261757, 2.7050692066483286, -0.6130987199611134, 0.015098408795893192, 0.015098408795893192],
        DEFAULT_ARM_SPEED
    ),
    MoveToHandoverProgram(
        [-1.7411623925131288, -1.6976283880200302, 1.7527606401443478, -2.4933927496525277, 0.13950533474816215, 2.7058760945929423, -0.6601669629878468, 0.015091842040419579, 0.015091842040419579],
        [-1.986881780829051, -1.7261419224655419, 1.7877880153656003, -2.028759749556321, 0.08599856294836604, 2.705053248498175, -0.614451490289635, 0.015098408795893192, 0.015098408795893192],
        0.11
    ),
    MoveToHandoverProgram(
        [-1.9037278494416618, -1.6979210991151459, 1.8520749450482819, -2.4630088715009295, 0.1430082124133517, 2.7058927646584627, -0.5494176698194608, 0.015091842040419579, 0.015091842040419579],
        [-1.9985437140046343, -1.7259969598703218, 1.8119275118662164, -2.1789313834006343, 0.11285665358437431, 2.705006852242682, -0.6121052901413705, 0.015098408795893192, 0.015098408795893192],
        0.12
    ),
    MoveToHandoverProgram(
        [-1.6964604606351077, -1.6981267437516596, 1.8476240948124936, -2.385564239369343, 0.1402486684454812, 2.7062718922558697, -0.5934494487908152, 0.015091842040419579, 0.015091842040419579],
        [-2.130696899129633, -1.726028942593357, 1.804976721428988, -2.145641970096756, 0.1128525749379476, 2.7050310893850815, -0.6121273732648954, 0.015098408795893192, 0.015098408795893192],
        0.13
    ),
    MoveToHandoverProgram(
        [-2.1053265234751235, -1.7260391433560935, 1.7754392948824365, -2.1453156734600403, 0.112851252509488, 2.7050297435065347, -0.6190795175698067, 0.015098736621439457, 0.015098736621439457],
        [-2.017048422612642, -1.726027080604582, 1.7850525591164303, -2.14500520947105, 0.112851252509488, 2.7050434192948867, -0.6176308433678415, 0.015098408795893192, 0.015098408795893192],
        0.16
    ),
    MoveToHandoverProgram(
        [-1.8678924610199445, -1.6958542249762079, 1.811306093567296, -2.3007969059074758, 0.1663232754204008, 2.705756882124477, -0.6152547399666574, 0.015092169865965843, 0.015092169865965843],
        [-2.0150696133060877, -1.7261183961567126, 1.8078723723762913, -2.086964722583168, 0.11283652913944422, 2.7050389433834283, -0.6132819780177539, 0.015098736621439457, 0.015098736621439457],
        0.14
    ),
    MoveToHandoverProgram(
        [-1.739731228918948, -1.7276463652828282, 1.7824389251180612, -2.1862916474116423, 0.1586859167151981, 2.706084618661139, -0.6289809664554065, 0.015091842040419579, 0.015091842040419579],
        [-1.9112968319634502, -1.72765736031114, 1.8048747212761327, -2.1365984971312746, 0.11283637389871809, 2.7050274123620595, -0.6160828455752797, 0.015098736621439457, 0.015098736621439457],
        0.2
    ),
    MoveToHandoverProgram(
        [-1.8589526765722977, -1.7279751537891856, 1.8306378445207028, -2.257267398231908, 0.16700712666246625, 2.7060729711188207, -0.6144564279384082, 0.015092169865965843, 0.015092169865965843],
        [-1.9052091093255619, -1.7277056307199166, 1.785176251702487, -2.0617797064195598, 0.11283637389871809, 2.70503894338344, -0.6182287057704394, 0.015098408795893192, 0.015098408795893192],
        0.17
    ),
    MoveToHandoverProgram(
        [-1.8584896059116744, -1.7278082491059825, 1.7400466414823714, -2.25843286437319, 0.1669577001068327, 2.706066969328456, -0.6692922171420521, 0.015092169865965843, 0.015092169865965843],
        [-1.9422408376508256, -1.7276965446137544, 1.818988702037878, -2.0974130004808003, 0.11456176782978905, 2.7050218694342507, -0.5976588408615854, 0.015098736621439457, 0.015098736621439457],
        0.25
    ),
    MoveToHandoverProgram(
        [-1.9214989425759563, -1.7277670063386883, 1.7707124769968055, -2.374402925993267, 0.16696634675463481, 2.7054116473991376, -0.6692658488419321, 0.015091842040419579, 0.015091842040419579],
        [-1.8468418886285078, -1.7275591352677644, 1.8378305550123513, -2.1871966576827195, 0.11456044540140364, 2.705026345345709, -0.5976703827049997, 0.015098736621439457, 0.015098736621439457],
        0.22
    ),
    MoveToHandoverProgram(
        [-1.594895482351777, -1.6579478930127132, 1.8290594049888347, -2.546119490127117, 0.1895465487771564, 2.7059256042464686, -0.6349153797295358, 0.015092169865965843, 0.015092169865965843],
        [-1.8804045224392738, -1.724886634090496, 1.8328600489800437, -2.2104691530820646, 0.11456644719176823, 2.705036578522859, -0.5984734631048307, 0.015098408795893192, 0.015098408795893192],
        0.28
    ),
    MoveToHandoverProgram(
        [-1.588009392453913, -1.6974995675285158, 1.962218952296073, -2.513075617695418, 0.18741147364510427, 2.705962588374386, -0.5466913311150339, 0.015092169865965843, 0.015092169865965843],
        [-2.0601097824450076, -1.7250488792162884, 1.81739155337685, -2.1698876279529773, 0.11456370060973697, 2.7050249211920634, -0.6016846108900176, 0.015098408795893192, 0.015098408795893192],
        0.3
    ),
    MoveToHandoverProgram(
        [-2.0574314267881664, -1.6987805819427755, 1.8904562154116034, -2.433488076266842, 0.19261571773385217, 2.7066801278723607, -0.6063578645851877, 0.015092169865965843, 0.015092169865965843],
        [-2.0075882707060426, -1.7272588134564852, 1.8067834760736168, -2.128870246519122, 0.11456176782978905, 2.705013438953294, -0.6006239009367094, 0.015098408795893192, 0.015098408795893192],
        0.28
    ),
    MoveToHandoverProgram(
        [-2.4125971445463326, -1.7293957772116895, 1.8171094837857966, -2.13265163368215, 0.182311491423183, 2.706652726735497, -0.6620182784861989, 0.015092169865965843, 0.015092169865965843],
        [-1.9564614573524761, -1.7270855337865023, 1.771425293989349, -2.1307936587319003, 0.11454767851444383, 2.705031113717291, -0.6072126230067676, 0.015098736621439457, 0.015098736621439457],
        0.32
    ),
    MoveToHandoverProgram(
        [-2.1007809845941106, -1.6911573175220878, 1.7100887247602103, -2.303616094975474, 0.21447103816166738, 2.70662092114278, -0.7716209022667673, 0.015092169865965843, 0.015092169865965843],
        [-1.9566308149873164, -1.7272600031787786, 1.7720633302740296, -2.0373319220124624, 0.11454509232134716, 2.705030694100592, -0.6072050953374968, 0.015098408795893192, 0.015098408795893192],
        0.3
    ),
    MoveToHandoverProgram(
        [-1.9247599122861918, -1.693554433684771, 1.8401756323537481, -2.4229295518774734, 0.21376195316844512, 2.706640984406328, -0.6599295306669342, 0.015092169865965843, 0.015092169865965843],
        [-1.9726060058694135, -1.7314177046658699, 1.8097687662271782, -2.045317441909906, 0.11404031271075252, 2.7050119130743875, -0.5647886713809436, 0.015098736621439457, 0.015098736621439457],
        0.35
    ),
    MoveToHandoverProgram(
        [-1.9410000279192243, -1.6926182550709943, 1.8959225026873103, -2.553772984621818, 0.21794519310527374, 2.7064627060227924, -0.6187823963628875, 0.015092169865965843, 0.015092169865965843],
        [-1.9996372668283027, -1.736508107658643, 1.8177782592618517, -2.0533125807778876, 0.1121049198044671, 2.7050089630418355, -0.5879931887454456, 0.015098408795893192, 0.015098408795893192],
        0.32
    ),
    MoveToHandoverProgram(
        [-1.392540206418037, -1.6533847335681577, 1.9135970029830933, -2.6677610552311877, 0.21795550152991408, 2.70629532664352, -0.595540888355838, 0.015092169865965843, 0.015092169865965843],
        [-2.041402657943859, -1.7365053104712946, 1.8216019733663191, -2.0812017274252375, 0.1168701806292479, 2.7050109716311863, -0.5704076441592639, 0.015098736621439457, 0.015098736621439457],
        0.28
    ),
    MoveToHandoverProgram(
        [-1.3917241876501787, -1.7088501409447694, 1.8606536047872129, -2.3704858996408027, 0.21076307798489713, 2.7062863748206034, -0.614154072648949, 0.015092169865965843, 0.015092169865965843],
        [-2.001539303490162, -1.7367186662941645, 1.799860850166856, -2.0146476441632, 0.11682197526428434, 2.7050236877732807, -0.580149935927656, 0.015098736621439457, 0.015098736621439457],
        0.38
    ),
    MoveToHandoverProgram(
        [-1.8782944451733798, -1.7080619575600873, 1.8841368447186653, -2.3828406788006165, 0.21611603881253133, 2.705581901960903, -0.6160331051018502, 0.015092169865965843, 0.015092169865965843],
        [-2.1053265234751235, -1.7260391433560935, 1.7754392948824365, -2.1453156734600403, 0.112851252509488, 2.7050297435065347, -0.6190795175698067, 0.015098736621439457, 0.015098736621439457],
        0.35
    ),
]
right_tray_handovers: List[MoveToHandoverProgram] = [
    MoveToHandoverProgram(
        [-1.5547487497664334, -1.7548655496061893, 1.8098866582403617, -2.195141738907591, 0.19108510024017758, 3.6259514539374242, -0.7562993065979746, 0.03935009241104126, 0.03935009241104126],
        [-1.979525540786877, -1.7568802659049967, 1.7494914613459918, -1.6939346870251333, 0.1910150717364417, 3.625722295510163, -0.8387378708985116, 0.03934943675994873, 0.03934943675994873],
        DEFAULT_ARM_SPEED
    ),
    MoveToHandoverProgram(
        [-1.9553351520631692, -1.7289233916600544, 1.764272976147765, -2.25836604827747, 0.15970306820339625, 3.5636313774663098, -0.781281786011325, 0.039349764585494995, 0.039349764585494995],
        [-2.3174051406017306, -1.7464846269616918, 1.7174293490793224, -1.8560868397825845, 0.19099589394198524, 3.5632729483577936, -0.8292145864632393, 0.03934943675994873, 0.03934943675994873],
        DEFAULT_ARM_SPEED
    ),
    MoveToHandoverProgram(
        [-1.9553351520631692, -1.7289233916600544, 1.764272976147765, -2.25836604827747, 0.15970306820339625, 3.5636313774663098, -0.781281786011325, 0.039349764585494995, 0.039349764585494995],
        [-2.3174051406017306, -1.7464846269616918, 1.7174293490793224, -1.8560868397825845, 0.19099589394198524, 3.5632729483577936, -0.8292145864632393, 0.03934943675994873, 0.03934943675994873],
        DEFAULT_ARM_SPEED
    ),
    MoveToHandoverProgram(
        [-1.9553351520631692, -1.7289233916600544, 1.764272976147765, -2.25836604827747, 0.15970306820339625, 3.5636313774663098, -0.781281786011325, 0.039349764585494995, 0.039349764585494995],
        [-2.3174051406017306, -1.7464846269616918, 1.7174293490793224, -1.8560868397825845, 0.19099589394198524, 3.5632729483577936, -0.8292145864632393, 0.03934943675994873, 0.03934943675994873],
        DEFAULT_ARM_SPEED
    ),
    MoveToHandoverProgram(
        [-1.9553351520631692, -1.7289233916600544, 1.764272976147765, -2.25836604827747, 0.15970306820339625, 3.5636313774663098, -0.781281786011325, 0.039349764585494995, 0.039349764585494995],
        [-2.3174051406017306, -1.7464846269616918, 1.7174293490793224, -1.8560868397825845, 0.19099589394198524, 3.5632729483577936, -0.8292145864632393, 0.03934943675994873, 0.03934943675994873],
        DEFAULT_ARM_SPEED
    ),
    MoveToHandoverProgram(
        [-1.9553351520631692, -1.7289233916600544, 1.764272976147765, -2.25836604827747, 0.15970306820339625, 3.5636313774663098, -0.781281786011325, 0.039349764585494995, 0.039349764585494995],
        [-2.3174051406017306, -1.7464846269616918, 1.7174293490793224, -1.8560868397825845, 0.19099589394198524, 3.5632729483577936, -0.8292145864632393, 0.03934943675994873, 0.03934943675994873],
        DEFAULT_ARM_SPEED
    ),
    MoveToHandoverProgram(
        [-1.9553351520631692, -1.7289233916600544, 1.764272976147765, -2.25836604827747, 0.15970306820339625, 3.5636313774663098, -0.781281786011325, 0.039349764585494995, 0.039349764585494995],
        [-2.3174051406017306, -1.7464846269616918, 1.7174293490793224, -1.8560868397825845, 0.19099589394198524, 3.5632729483577936, -0.8292145864632393, 0.03934943675994873, 0.03934943675994873],
        DEFAULT_ARM_SPEED
    ),
    MoveToHandoverProgram(
        [-1.9553351520631692, -1.7289233916600544, 1.764272976147765, -2.25836604827747, 0.15970306820339625, 3.5636313774663098, -0.781281786011325, 0.039349764585494995, 0.039349764585494995],
        [-2.3174051406017306, -1.7464846269616918, 1.7174293490793224, -1.8560868397825845, 0.19099589394198524, 3.5632729483577936, -0.8292145864632393, 0.03934943675994873, 0.03934943675994873],
        DEFAULT_ARM_SPEED
    ),
    MoveToHandoverProgram(
        [-1.9553351520631692, -1.7289233916600544, 1.764272976147765, -2.25836604827747, 0.15970306820339625, 3.5636313774663098, -0.781281786011325, 0.039349764585494995, 0.039349764585494995],
        [-2.3174051406017306, -1.7464846269616918, 1.7174293490793224, -1.8560868397825845, 0.19099589394198524, 3.5632729483577936, -0.8292145864632393, 0.03934943675994873, 0.03934943675994873],
        DEFAULT_ARM_SPEED
    ),
    MoveToHandoverProgram(
        [-1.9553351520631692, -1.7289233916600544, 1.764272976147765, -2.25836604827747, 0.15970306820339625, 3.5636313774663098, -0.781281786011325, 0.039349764585494995, 0.039349764585494995],
        [-2.3174051406017306, -1.7464846269616918, 1.7174293490793224, -1.8560868397825845, 0.19099589394198524, 3.5632729483577936, -0.8292145864632393, 0.03934943675994873, 0.03934943675994873],
        DEFAULT_ARM_SPEED
    ),
    MoveToHandoverProgram(
        [-1.9553351520631692, -1.7289233916600544, 1.764272976147765, -2.25836604827747, 0.15970306820339625, 3.5636313774663098, -0.781281786011325, 0.039349764585494995, 0.039349764585494995],
        [-2.3174051406017306, -1.7464846269616918, 1.7174293490793224, -1.8560868397825845, 0.19099589394198524, 3.5632729483577936, -0.8292145864632393, 0.03934943675994873, 0.03934943675994873],
        DEFAULT_ARM_SPEED
    ),
    MoveToHandoverProgram(
        [-1.9553351520631692, -1.7289233916600544, 1.764272976147765, -2.25836604827747, 0.15970306820339625, 3.5636313774663098, -0.781281786011325, 0.039349764585494995, 0.039349764585494995],
        [-2.3174051406017306, -1.7464846269616918, 1.7174293490793224, -1.8560868397825845, 0.19099589394198524, 3.5632729483577936, -0.8292145864632393, 0.03934943675994873, 0.03934943675994873],
        DEFAULT_ARM_SPEED
    ),
    MoveToHandoverProgram(
        [-1.9553351520631692, -1.7289233916600544, 1.764272976147765, -2.25836604827747, 0.15970306820339625, 3.5636313774663098, -0.781281786011325, 0.039349764585494995, 0.039349764585494995],
        [-2.3174051406017306, -1.7464846269616918, 1.7174293490793224, -1.8560868397825845, 0.19099589394198524, 3.5632729483577936, -0.8292145864632393, 0.03934943675994873, 0.03934943675994873],
        DEFAULT_ARM_SPEED
    ),
    MoveToHandoverProgram(
        [-1.9553351520631692, -1.7289233916600544, 1.764272976147765, -2.25836604827747, 0.15970306820339625, 3.5636313774663098, -0.781281786011325, 0.039349764585494995, 0.039349764585494995],
        [-2.3174051406017306, -1.7464846269616918, 1.7174293490793224, -1.8560868397825845, 0.19099589394198524, 3.5632729483577936, -0.8292145864632393, 0.03934943675994873, 0.03934943675994873],
        DEFAULT_ARM_SPEED
    ),
    MoveToHandoverProgram(
        [-1.9553351520631692, -1.7289233916600544, 1.764272976147765, -2.25836604827747, 0.15970306820339625, 3.5636313774663098, -0.781281786011325, 0.039349764585494995, 0.039349764585494995],
        [-2.3174051406017306, -1.7464846269616918, 1.7174293490793224, -1.8560868397825845, 0.19099589394198524, 3.5632729483577936, -0.8292145864632393, 0.03934943675994873, 0.03934943675994873],
        DEFAULT_ARM_SPEED
    ),
    MoveToHandoverProgram(
        [-1.9553351520631692, -1.7289233916600544, 1.764272976147765, -2.25836604827747, 0.15970306820339625, 3.5636313774663098, -0.781281786011325, 0.039349764585494995, 0.039349764585494995],
        [-2.3174051406017306, -1.7464846269616918, 1.7174293490793224, -1.8560868397825845, 0.19099589394198524, 3.5632729483577936, -0.8292145864632393, 0.03934943675994873, 0.03934943675994873],
        DEFAULT_ARM_SPEED
    ),
    MoveToHandoverProgram(
        [-1.9553351520631692, -1.7289233916600544, 1.764272976147765, -2.25836604827747, 0.15970306820339625, 3.5636313774663098, -0.781281786011325, 0.039349764585494995, 0.039349764585494995],
        [-2.3174051406017306, -1.7464846269616918, 1.7174293490793224, -1.8560868397825845, 0.19099589394198524, 3.5632729483577936, -0.8292145864632393, 0.03934943675994873, 0.03934943675994873],
        DEFAULT_ARM_SPEED
    ),
    MoveToHandoverProgram(
        [-1.9553351520631692, -1.7289233916600544, 1.764272976147765, -2.25836604827747, 0.15970306820339625, 3.5636313774663098, -0.781281786011325, 0.039349764585494995, 0.039349764585494995],
        [-2.3174051406017306, -1.7464846269616918, 1.7174293490793224, -1.8560868397825845, 0.19099589394198524, 3.5632729483577936, -0.8292145864632393, 0.03934943675994873, 0.03934943675994873],
        DEFAULT_ARM_SPEED
    ),
    MoveToHandoverProgram(
        [-1.9553351520631692, -1.7289233916600544, 1.764272976147765, -2.25836604827747, 0.15970306820339625, 3.5636313774663098, -0.781281786011325, 0.039349764585494995, 0.039349764585494995],
        [-2.3174051406017306, -1.7464846269616918, 1.7174293490793224, -1.8560868397825845, 0.19099589394198524, 3.5632729483577936, -0.8292145864632393, 0.03934943675994873, 0.03934943675994873],
        DEFAULT_ARM_SPEED
    ),
    MoveToHandoverProgram(
        [-1.9553351520631692, -1.7289233916600544, 1.764272976147765, -2.25836604827747, 0.15970306820339625, 3.5636313774663098, -0.781281786011325, 0.039349764585494995, 0.039349764585494995],
        [-2.3174051406017306, -1.7464846269616918, 1.7174293490793224, -1.8560868397825845, 0.19099589394198524, 3.5632729483577936, -0.8292145864632393, 0.03934943675994873, 0.03934943675994873],
        DEFAULT_ARM_SPEED
    ),
]


def move_to_left_tray(move_group, *args, **kwargs):
    global left_tray_handovers, left_tray_index

    program = left_tray_handovers[left_tray_index]

    # move to close to handover location
    move_to_pose(move_group, program.target_1[0], program.target_1[1], program.target_1[2], program.target_1[3], program.target_1[4], program.target_1[5], program.target_1[6], None, None, program.speed)
    notify_arm_location("handover_location")

    # move to specific handover location
    move_to_pose(move_group, program.target_2[0], program.target_2[1], program.target_2[2], program.target_2[3], program.target_2[4], program.target_2[5], program.target_2[6])
    left_tray_index += 1


def move_to_right_tray(move_group, *args, **kwargs):
    global right_tray_handovers, right_tray_index

    program = right_tray_handovers[right_tray_index]

    # move to close to handover location
    move_to_pose(move_group, program.target_1[0], program.target_1[1], program.target_1[2], program.target_1[3], program.target_1[4], program.target_1[5], program.target_1[6], None, None, program.speed)
    notify_arm_location("handover_location")

    # move to specific handover location
    move_to_pose(move_group, program.target_2[0], program.target_2[1], program.target_2[2], program.target_2[3], program.target_2[4], program.target_2[5], program.target_2[6])
    right_tray_index += 1


def move_to_packaging(move_group, *args, **kwargs):
    global packaging_containers, current_container_index, number_of_items_in_container
    # move to packaging common
    move_to_pose(move_group, 0.5817468816737505, -1.706521653995179, 1.7520496511799224, -2.3061350115391246, 0.1577046152485714, 2.8383838765753637, -0.7505379780597156, 0.015098736621439457, 0.015098736621439457)
    notify_arm_location("packaging")

    # move to specific container and rotate
    cp = packaging_containers[current_container_index]
    move_to_pose(move_group, cp.container_pose[0], cp.container_pose[1], cp.container_pose[2], cp.container_pose[3], cp.container_pose[4], cp.container_pose[5], cp.container_pose[6], None, None, 0.3)
    move_to_pose(move_group, cp.rotation_pose[0], cp.rotation_pose[1], cp.rotation_pose[2], cp.rotation_pose[3], cp.rotation_pose[4], cp.rotation_pose[5], cp.rotation_pose[6], None, None, 0.5)
    move_to_pose(move_group, cp.container_pose[0], cp.container_pose[1], cp.container_pose[2], cp.container_pose[3], cp.container_pose[4], cp.container_pose[5], cp.container_pose[6], None, None, 0.5)

    number_of_items_in_container += 1
    print("Current Container:", current_container_index, "--", "Number of Items:", number_of_items_in_container)
    if number_of_items_in_container == 8:
        current_container_index += 1
        number_of_items_in_container = 0

    if current_container_index >= len(packaging_containers):
        notify_handover_finished()
    
    # move to packaging common
    move_to_pose(move_group, 0.5817468816737505, -1.706521653995179, 1.7520496511799224, -2.3061350115391246, 0.1577046152485714, 2.8383838765753637, -0.7505379780597156, 0.015098736621439457, 0.015098736621439457)


def move_to_idle(move_group, *args, **kwargs):
    move_to_pose(move_group, 0.06557577479094788, -1.6753117668339241, 1.7382581317488122, -2.860015985990825, 0.29034876888328126, 2.8374400304023855, -0.9013231238192982, 0.015098736621439457, 0.015098736621439457)
    notify_arm_location("idle")


def prepare_experiment(move_group, home_gripper_client, grasp_client) -> None:
    home_gripper(home_gripper_client)
    move_to_home(move_group)
    move_to_idle(move_group)
    grasp(grasp_client, 0.035)
    print("Press ENTER to grasp bowl ...")
    input()
    grasp(grasp_client, 0.03)
    print("Press ENTER to continue ...")
    input()


def end_experiment(move_group, home_gripper_client, grasp_client) -> None:
    move_to_idle(move_group)
    print("Press ENTER to release bowl ...")
    input()
    grasp(grasp_client, 0.035)
    print("Press ENTER to when you removed the bowl ...")
    input()
    move_to_home(move_group)
    home_gripper(home_gripper_client)


PROGRAMS: Dict[str, Callable] = {
    "move_to_left_tray": move_to_left_tray,
    "move_to_right_tray": move_to_right_tray,
    "move_to_packaging": move_to_packaging,
    "move_to_idle": move_to_idle,
    "prepare_experiment": prepare_experiment,
    "end_experiment": end_experiment,
}